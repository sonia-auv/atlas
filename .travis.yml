# S.O.N.I.A. Continuous Integration Configuration File
# Author: Thibaut Mattio

language:
  - cpp
  - python

python:
  - "2.7"

compiler:
  - gcc

os:
  - linux

dist: trusty

notifications:
  email:
    recipients:
      - thibaut.mattio@gmail.com
    on_success: never
    on_failure: always
  slack:
    rooms:
      - sonia-auv:VuDl4QAG49oxkr53yCiKMAxH
    on_success: change
    on_failure: change

before_install:
  - export ROS_DISTRO=indigo
  - export CI_SOURCE_PATH=$(pwd)
  - export REPOSITORY_NAME=${PWD##*/}
  - echo "Testing branch $TRAVIS_BRANCH of $REPOSITORY_NAME"
  - sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
  - sudo apt-key adv --keyserver hkp://pool.sks-keyservers.net --recv-key 0xB01FA116
  - sudo apt-get update -qq
  - sudo apt-get install -qq ros-indigo-ros-base python-pip
  - sudo pip install -U rospkg rosdep caktin-pkg rosinstall vcstools
  - sudo rosdep init
  - rosdep update

install:
  # Create workspace
  - source /opt/ros/$ROS_DISTRO/setup.bash
  - mkdir -p ~/catkin_ws/src
  - cd ~/catkin_ws/src
  - catkin_init_workspace
  # Clonning dependencies for the repository
  - git clone https://github.com/sonia-auv/lib_atlas.git
  - cd ~/catkin_ws/

before_script:
  - source /opt/ros/$ROS_DISTRO/setup.bash

script:
  # Some base informations on python for debug
  - which python
  - python -V
  - dpkg -L python-catkin-pkg
  # Actuall build
  - catkin_make -j8 --pkg lib_atlas
